function render(){xValue=function(t){return t[headers[xIndex]]},xMap=function(t){return xScale(xValue(t))},yValue=function(t){return t[headers[yIndex]]},yMap=function(t){return yScale(yValue(t))};var t=d3.max(data,xValue)-d3.min(data,xValue),e=d3.max(data,yValue)-d3.min(data,yValue);xScale.domain([d3.min(data,xValue)-t/10,d3.max(data,xValue)+t/10]),yScale.domain([d3.min(data,yValue)-e/10,d3.max(data,yValue)+e/10]),xAxisObj.call(xAxis),xAxisLabelSelector.text(headers[xIndex]),yAxisObj.call(yAxis),yAxisLabelSelector.text(headers[yIndex]),dotsObj.transition().duration(Math.floor(20*Math.random())+80).attr("cx",xMap).attr("cy",yMap)}function addLegend(){var t=svg.selectAll(".legend").data(color.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});t.append("rect").attr("x",width-18).attr("width",18).attr("height",18).style("fill",color),t.append("text").attr("x",width-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})}var margin={top:20,right:20,bottom:30,left:40},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom,xScale=d3.scale.linear().range([0,width]),yScale=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(xScale).orient("bottom"),yAxis=d3.svg.axis().scale(yScale).orient("left"),xValue,xMap,yValue,yMap,cValue=function(t){return t.Manufacturer},color=d3.scale.category10(),svg=d3.select(".plot-box").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),tooltip=d3.select(".plot-box").append("div").attr("class","tooltip").style("opacity",0),headers=[],axisListHTML="",xAxisSelector=document.querySelector("#x-axis-selector"),yAxisSelector=document.querySelector("#y-axis-selector"),xAxisLabelSelector,yAxisLabelSelector,xIndex=0,yIndex=1,xAxisObj,yAxisObj,dotsObj;d3.csv("data/cereal.csv",function(t,e){e.forEach(function(t){Object.keys(t).forEach(function(e){isNaN(t[e])||(t[e]=+t[e])})}),data=e,Object.keys(data[0]).forEach(function(t){isNaN(data[0][t])||headers.push(t)}),headers.forEach(function(t){axisListHTML+="<option value="+t+">"+t+"</option>"}),xAxisSelector.innerHTML=axisListHTML,yAxisSelector.innerHTML=axisListHTML,xAxisSelector.value=headers[xIndex],yAxisSelector.value=headers[yIndex],document.querySelector(".selector-box").style.display="block",xAxisSelector.onchange=function(){xIndex=this.options.selectedIndex,render()},yAxisSelector.onchange=function(){yIndex=this.options.selectedIndex,render()},xAxisObj=svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")"),xAxisObj.append("text").attr("class","x-axis-label label").attr("x",width).attr("y",-6).style("text-anchor","end"),xAxisLabelSelector=d3.select(".x-axis-label"),yAxisObj=svg.append("g").attr("class","y axis"),yAxisObj.append("text").attr("class","y-axis-label label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end"),yAxisLabelSelector=d3.select(".y-axis-label"),dotsObj=svg.selectAll(".dot").data(data).enter().append("circle"),dotsObj.attr("class","dot").attr("r",4.5).style("fill",function(t){return color(cValue(t))}).style("opacity",function(t){return.4}),render()});